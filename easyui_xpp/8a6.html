<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>角色管理</title>
    <script type="text/javascript" src="jquery-easyui-136/jquery.min.js"></script>
    <script type="text/javascript" src="DataTables/datatables.js"></script>
    <script type="text/javascript" src="jquery-easyui-136/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="jquery-easyui-136/locale/easyui-lang-zh_CN.js"></script>
    <script type="text/javascript" src="../xppjs/jquery.serialize-object.js"></script>
    <link  rel="stylesheet" type="text/css" href="DataTables/datatables.css"/>
    <link  rel="stylesheet" type="text/css" href="jquery-easyui-136/themes/gray/easyui.css"/>
    <link  rel="stylesheet" type="text/css" href="../HMcode/HMcss/8a6.css"/>
</head>
<body>
<div class="tab-con">
    <div id="header_1" >
        <h2>角色管理</h2>
    </div>
    <div class="btn-main">
        <button class="btn-class" id="btn-del">删除</button>
        <button class="btn-class" id="btn-edi">编辑</button>
    </div>
    <!--S--表格开始 -->
    <table id="adm-user" class="display tab-mians" cellspacing="0" width="100%">
        <thead class="tab-tit">
            <tr>
                <th style="min-width: 200px">角色</th>
                <th style="min-width: 700px;">备注信息</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
        <tfoot class="tab-tit">
            <tr>
                <th style="min-width: 200px">角色</th>
                <th style="min-width: 700px;">备注信息</th>
            </tr>
        </tfoot>
    </table>
    <!--E--表格结束 -->
    <!-- S--编辑弹窗 -->
    <div id="dialog" title="角色编辑" class="easyui-dialog" closed="true" style="width:900px;height: 420px;padding-left: 20px;overflow: scroll">
        <form id="form-id" name="form_data">
            <ul class="tab-style">
                <li class="fir"><i class="name-s">输入角色</i><input type="text" id="name" class="yzss" name="name" placeholder="请输入角色"></li>
                <li><i class="name-s">备注信息</i><input name = "remark" style="width:300px;" id="remark" type="text" class="yzss" placeholder="请输入备注信息"></li>
            </ul>
            <div class="box_zyb">
                <p>资&nbsp;源&nbsp;表</p>
                <!--easyui树的引用-->
                <ul id="tree" class="easyui-tree" data-options="url:'tree_roleRS.json',method:'get',animate:true,checkbox:true,cascadeCheck:false">

                </ul>
            </div>
        </form>
        <div class="btn-box" style="margin-right: 25px;overflow: hidden;padding-bottom: 15px;">
            <button id="close-d"  class="easyui-linkbutton btn-xk">关闭</button>
            <button id="confirm-d" class="easyui-linkbutton btn-qr">确认</button>
        </div>
    </div>
    <!-- E--编辑弹窗 -->
</div>
</body>
<script>
    $(document).ready(function(){
        /* 对话框关闭事件 */
        $(function(){
            $('.panel-tool ,#close-d').click(function(){
                $( "#dialog" ).dialog( "close" );
            })
        });
        /* 第一步：展示列表数据 */
        var tabData = $("#adm-user").DataTable({
            ajax:{
                url:"/sdpk/aaRole?qqiu=list"
            },
            columns:[
                {"data":"name"},
                { "data":"remark"}
            ]
        });
        /* 第二步：对选中列表进行操作 */
        var selTable = $("#adm-user").on("click","tr",function(){
            if($(this).hasClass("selected")){
                $(this).removeClass("selected")
            }else{
                $('tr.selected').removeClass('selected');
                $(this).addClass("selected");
            }
        });
        /* 第三步：删除按钮的事件 */
        $("#btn-del").click(function(){
            var delTableTr = {};
            delTableTr = tabData.row(".selected").data();
            tabData.row(".selected").remove().draw(false);//在页面进行删除操作
            var delCon = delTableTr.uuid;
            var delData = {};
            delData.uuid = delCon;
            /* ajax调用数据接口 */
            $.ajax({
                url:"/sdpk/aaRole?qqiu=delete",
                type:"POST",
                data:JSON.stringify(delData),
                contentType:"application/json;charset=UTF-8",
                success:function(result){
                    alert("删除成功");
                    window.location.reload();//页面刷新
                }
            });
        });
        /* 第四步：点击编辑按钮出现弹窗 */
        //获取选中行的值，并把值给到弹窗相应的位置
        $("#btn-edi").click(function(){
            var delTableTr = {};//定义一个空的对象
            delTableTr = tabData.row(".selected").data();//吧选中行的所有数据给到这个新的对象
            //吧获取到的值给到弹窗里面的value
            $('input[name="name"]').val(delTableTr.name);
            $('input[name = "remark"]').val(delTableTr.remark);
            var root = $('#tree').tree("getRoot");
            $("#tree").tree('uncheck',root.target);
            for(var i=0;i<delTableTr.rsList.length;i++){
                var node = $("#tree").tree("find",delTableTr.rsList[i]);
                $('#tree').tree("check",node.target);
                console.log(delTableTr.rsList[i]);
            }
            $( "#dialog" ).dialog( "open" );//出现编辑弹窗
        });
        /* 第五步：点击提交按钮事件 */
        $("#confirm-d").click(function(){
            var ediTab = {};//定义一个空的对象，用于存放选中行的数值
            ediTab = tabData.row(".selected").data();
            var sendTab = {};//定义一个空对象，用于存放修改后传送的数值
            sendTab.uuid = ediTab.uuid;
            sendTab.name = $('input[name = "name"]')[0].value;
            sendTab.remark = $('input[name = "remark"]')[0].value;
            /* ajax数据的调用 */
            $.ajax({
                url:"/sdpk/aaRole?qqiu=edit",
                type:"POST",
                data:JSON.stringify(sendTab),
                contentType:"application/json;charset=UTF-8",
                success:function(result){
                    alert("修改成功");
                    window.location.reload();
                }
            })
        });
    });
</script>
</html>